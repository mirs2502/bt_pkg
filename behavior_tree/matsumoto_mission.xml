cat << 'EOF' > ~/mirs_ws/src/bt_pkg/behavior_tree/matsumoto_mission.xml
<root main_tree_to_execute="MainTree">
    <TreeNodesModel>
        <Action ID="ScanAndCreatePolygon">
            <input_port name="node"/>
            <output_port name="polygon_map"/>
        </Action>
        <Action ID="GenerateCoveragePath">
            <input_port name="node"/>
            <input_port name="polygon_map"/>
            <output_port name="coverage_path"/>
        </Action>
        <Action ID="LocalizeWithCones">
            <input_port name="node"/>
        </Action>
        <Action ID="Wait">
            <input_port name="wait_duration" default="1.0"/>
            <input_port name="server_name" default="wait"/>
        </Action>
        <Action ID="Spin">
            <input_port name="spin_dist" default="1.57"/>
            <input_port name="server_name" default="spin"/>
        </Action>
        <Action ID="NavigateThroughPoses">
            <input_port name="goals"/>
            <input_port name="server_name" default="navigate_through_poses"/>
        </Action>
    </TreeNodesModel>

    <BehaviorTree ID="MainTree">
        <Sequence name="MainSequence">
            <Sequence name="SetupSeq">
                <Wait wait_duration="1.0"/>
                <Spin spin_dist="6.28"/>
                <ScanAndCreatePolygon node="{node}" polygon_map="{my_polygon}"/>
            </Sequence>

            <Sequence name="PlanSeq">
                <GenerateCoveragePath node="{node}" polygon_map="{my_polygon}" coverage_path="{my_path}"/>
            </Sequence>

            <Fallback name="ExecFallback">
                <Sequence name="NavSeq">
                    <NavigateThroughPoses goals="{my_path}"/>
                </Sequence>
                
                <Sequence name="RecSeq">
                    <Wait wait_duration="2.0" name="Stop"/>
                    <LocalizeWithCones node="{node}"/>
                    <NavigateThroughPoses goals="{my_path}" name="RetryNav"/>
                </Sequence>
            </Fallback>
        </Sequence>
    </BehaviorTree>
</root>
EOF
